<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="sunsynk"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
	xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">


	<!-- Bridge Thing Type -->

	<bridge-type id="account">
		<label>SunSynk Account</label>
		<description>Access to SunSynk Account. Used to discover plants and inverters tied to account.</description>
		<properties>
			<property name="vendor">SunSynk</property>
		</properties>
		<config-description>
			<parameter name="email" type="text" required="true">
				<label>E-mail Address</label>
				<description>E-mail address for your SunSynk Connect account.</description>
				<context>email</context>
			</parameter>
			<parameter name="password" type="text" required="true">
				<label>Password</label>
				<description>Password for your SunSynk Connect account.</description>
				<context>password</context>
			</parameter>
			<parameter name="access_token" type="text" required="false">
				<label>SunSynk Secret</label>
				<description>Secret for accessing SunSynk Connect services.</description>
				<advanced>true</advanced>
			</parameter>
			<parameter name="refresh_token" type="text" required="false">
				<label>SunSynk Refresh Secret</label>
				<description>SunSynk Connect services refresh secret.</description>
				<advanced>true</advanced>
			</parameter>
			<parameter name="expires_in" type="integer" required="false">
				<label>SunSynk Secret expiry</label>
				<description>SunSynk Connect services token expiry in seconds.</description>
				<advanced>true</advanced>
			</parameter>
			<parameter name="issued_at" type="integer" required="false">
				<label>SunSynk Secret issue time stamp</label>
				<description>SunSynk Connect services token issue time stamp.</description>
				<advanced>true</advanced>
			</parameter>
		</config-description>

	</bridge-type>


	<!-- Inverter Thing Type -->
	<thing-type id="inverter">
		<supported-bridge-type-refs>
			<bridge-type-ref id="account"/>
		</supported-bridge-type-refs>
		<label>SunSynk Inverter</label>
		<description>Inverter thing for SunSynk Binding.</description>
		<!-- Comment this in for Things which need a Bridge to function.
		-->

		<channels>
			<channel id="interval-1-grid-charge" typeId="grid-charge"/>
			<channel id="interval-1-grid-time" typeId="grid-time"/>
			<channel id="interval-1-grid-capacity" typeId="battery-target"/>
			<channel id="interval-1-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-2-grid-charge" typeId="grid-charge"/>
			<channel id="interval-2-grid-time" typeId="grid-time"/>
			<channel id="interval-2-grid-capacity" typeId="battery-target"/>
			<channel id="interval-2-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-3-grid-charge" typeId="grid-charge"/>
			<channel id="interval-3-grid-time" typeId="grid-time"/>
			<channel id="interval-3-grid-capacity" typeId="battery-target"/>
			<channel id="interval-3-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-4-grid-charge" typeId="grid-charge"/>
			<channel id="interval-4-grid-time" typeId="grid-time"/>
			<channel id="interval-4-grid-capacity" typeId="battery-target"/>
			<channel id="interval-4-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-5-grid-charge" typeId="grid-charge"/>
			<channel id="interval-5-grid-time" typeId="grid-time"/>
			<channel id="interval-5-grid-capacity" typeId="battery-target"/>
			<channel id="interval-5-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-6-grid-charge" typeId="grid-charge"/>
			<channel id="interval-6-grid-time" typeId="grid-time"/>
			<channel id="interval-6-grid-capacity" typeId="battery-target"/>
			<channel id="interval-6-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="interval-1-gen-charge" typeId="gen-charge"/>
			<channel id="interval-2-gen-charge" typeId="gen-charge"/>
			<channel id="interval-3-gen-charge" typeId="gen-charge"/>
			<channel id="interval-4-gen-charge" typeId="gen-charge"/>
			<channel id="interval-5-gen-charge" typeId="gen-charge"/>
			<channel id="interval-6-gen-charge" typeId="gen-charge"/>
			<channel id="battery-SOC" typeId="system.battery-level"/>
			<channel id="battery-grid-voltage" typeId="system.electric-voltage"/>
			<channel id="battery-grid-current" typeId="system.electric-current"/>
			<channel id="battery-grid-power" typeId="system.electric-power"/>
			<channel id="battery-temperature" typeId="system.indoor-temperature"/>
			<channel id="inverter-ac-temperature" typeId="system.indoor-temperature"/>
			<channel id="inverter-dc-temperature" typeId="system.indoor-temperature"/>
			<channel id="inverter-grid-power" typeId="system.electric-power"/>
			<channel id="inverter-grid-voltage" typeId="system.electric-voltage"/>
			<channel id="inverter-grid-current" typeId="system.electric-current"/>
			<channel id="inverter-solar-energy-today" typeId="system.electric-energy"/>
			<channel id="inverter-solar-energy-total" typeId="system.electric-energy"/>
			<channel id="inverter-solar-power-now" typeId="system.electric-current"/>
			<channel id="inverter-control-timer" typeId="control-timer"/>
			<channel id="inverter-control-energy-pattern" typeId="control-pattern"/>
			<channel id="inverter-control-work-mode" typeId="control-work-mode"/>
		</channels>

		<properties>
			<property name="vendor">SunSynk</property>
		</properties>

		<representation-property>sn</representation-property>

		<config-description>
			<parameter name="sn" type="text" required="true">
				<label>Sun Synk Inverter Serial</label>
				<description>Serial number of the inverter from Sun Synk Connect.</description>
			</parameter>
			<parameter name="alias" type="text" required="true">
				<label>Sun Synk Inverter Name</label>
				<description>Name of inverter from Sun Synk Connect.</description>
			</parameter>
			<parameter name="refresh" type="integer" required="true">
				<label>Refresh time interval.</label>
				<description>Time in seconds to retrieve status from Sun Synk Connect services. Greater than 60 seconds.</description>
				<default> 60 </default>
				<advanced>true</advanced>
			</parameter>
		</config-description>


	</thing-type>

	<!-- Plant Thing Type -->
	<!--
		<thing-type id="plant">
		<supported-bridge-type-refs>
		<bridge-type-ref id="sunsynkaccount" />
		</supported-bridge-type-refs>
	-->
	<!-- Comment this in for Things which need a Bridge to function.
	-->
	<thing-type id="plant">
		<supported-bridge-type-refs>
			<bridge-type-ref id="sunsynkaccount"/>
		</supported-bridge-type-refs>
		<label>SunSynk Plant</label>
		<description>Plant thing for SunSynk Binding</description>

		<channels>
			<channel id="plant-status" typeId="plant-status"/>
		</channels>

		<config-description>
			<parameter name="hostname" type="text" required="true">
				<context>network-address</context>
				<label>Hostname</label>
				<description>Hostname or IP address of the device</description>
			</parameter>
			<parameter name="password" type="text" required="true">
				<context>password</context>
				<label>Password</label>
				<description>Password to access the device</description>
			</parameter>
			<parameter name="serial" type="text" required="true">
				<context>password</context>
				<label>Gateway Serial Number</label>
				<description>Serial number of the gateway</description>
			</parameter>
			<parameter name="refreshInterval" type="integer" unit="s" min="1">
				<label>Refresh Interval</label>
				<description>Interval the device is polled in sec.</description>
				<default>600</default>
				<advanced>true</advanced>
			</parameter>
		</config-description>
	</thing-type>

	<channel-type id="grid-time" advanced="true">
		<item-type>DateTime</item-type>
		<label>Grid charge interval start time</label>
		<description>"24hr time for the start of the interval. 00:00 to 23:55 are valid in 5 min increments with leading zero
			on the hour and minute. Times must be in ascending order. ".</description>
		<state readOnly="false"/> <!--- pattern="%1$tH:%1$tM"/> -->
	</channel-type>

	<channel-type id="grid-charge" advanced="true">
		<item-type>Switch</item-type>
		<label>Grid charge this interval</label>
		<description>charge the inverter battery from the grid.</description>
		<state readOnly="false" pattern="%s"/>
	</channel-type>

	<channel-type id="gen-charge" advanced="true">
		<item-type>Switch</item-type>
		<label>Generator (auxilary) charge this interval</label>
		<description>charge the inverter battery from the generator auxilary.</description>
		<state readOnly="false" pattern="%s"/>
	</channel-type>

	<channel-type id="battery-target" advanced="true">
		<item-type>Number</item-type>
		<label>Target Charge Level</label>
		<category>Battery</category>
		<state min="0" max="100" step="1" pattern="%d" readOnly="false"/>
	</channel-type>

	<channel-type id="power-charge-limit" advanced="true">
		<item-type>Number</item-type>
		<label>Maximum charge rate</label>
		<category>Inverter</category>
		<state min="0" max="100" step="1" pattern="%d %unit%" readOnly="false"/>
	</channel-type>

	<channel-type id="control-timer" advanced="true">
		<item-type>Switch</item-type>
		<label>System Mode Timer</label>
		<description>Use the system mode timer to control battery charge discharge.</description>
		<state readOnly="false" pattern="%s"/>
	</channel-type>

	<channel-type id="control-pattern" advanced="true">
		<item-type>Number</item-type>
		<label>System Mode Energy Pattern</label>
		<description>'0' is Priority Battery and '1' is Priority Load.</description>
		<state min="0" max="1" readOnly="false" pattern="%d"/>
	</channel-type>

	<channel-type id="control-work-mode" advanced="true">
		<item-type>Number</item-type>
		<label>System Work Mode</label>
		<description>'0' is Selling First; '1' is Zero-Export + Limted to Load and '2' is Limited to Home.</description>
		<state min="0" max="2" readOnly="false" pattern="%d"/>
	</channel-type>




	<!-- plant-status Channel Type -->
	<channel-type id="plant-status">
		<item-type>String</item-type>
		<label>Current State</label><!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
		<description>State of plant</description>
		<state readOnly="true" pattern="%s">
			<options>
				<option value="OFFLINE">Offline</option>
				<option value="FAULT">Fault</option>
				<option value="WARNING">Warning</option>
				<option value="Normal">Pormal</option>
			</options>
		</state>
	</channel-type>
</thing:thing-descriptions>
