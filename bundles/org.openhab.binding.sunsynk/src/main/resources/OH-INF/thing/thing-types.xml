<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="sunsynk"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
	xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">


	<!-- Bridge Thing Type -->

	<bridge-type id="sunsynkaccount">
		<label>Sunsynk Account</label>
		<description>Access to SunSynk Account. Used to discover sites and inverters tied to account.</description>
		<properties>
			<property name="vendor">SunSynk</property>
		</properties>
		<config-description>
			<parameter name="email" type="text" required="true">
				<label>E-mail Address</label>
				<description>E-mail address for your SunSynk Cloud account.</description>
				<context>email</context>
			</parameter>
			<parameter name="password" type="text" required="true">
				<label>Password</label>
				<description>Password for your SunSynk Cloud account.</description>
				<context>password</context>
			</parameter>
			<parameter name="access_token" type="text" required="false">
				<label>SunSynk Secret</label>
				<description>Secret for accessing SunSynk web services</description>
				<advanced>true</advanced>
			</parameter>
			<parameter name="refresh_token" type="text" required="false">
				<label>SunSynk Refresh Secret</label>
				<description>SunSynk web services refresh secret</description>
				<advanced>true</advanced>
			</parameter>
			<parameter name="expires_in" type="text" required="false">
				<label>SunSynk Secret expiry</label>
				<description>SunSynk web services secret expiry</description>
				<advanced>true</advanced>
			</parameter>
		</config-description>

	</bridge-type>


	<!-- Inverter Thing Type -->
	<thing-type id="inverter">
		<supported-bridge-type-refs>
			<bridge-type-ref id="sunsynkaccount"/>
		</supported-bridge-type-refs>
		<label>SunSynk Inverter</label>
		<description>Inverter thing for SunSynk Binding.</description>
		<!-- Comment this in for Things which need a Bridge to function.
		-->

		<channels>
			<channel id="Interval-1-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-1-grid-time" typeId="grid-tme"/>
			<channel id="Interval-1-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-1-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-2-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-2-grid-time" typeId="grid-tme"/>
			<channel id="Interval-2-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-2-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-3-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-3-grid-time" typeId="grid-tme"/>
			<channel id="Interval-3-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-3-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-4-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-4-grid-time" typeId="grid-tme"/>
			<channel id="Interval-4-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-4-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-5-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-5-grid-time" typeId="grid-tme"/>
			<channel id="Interval-5-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-5-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-6-grid-charge" typeId="grid-charge"/>
			<channel id="Interval-6-grid-time" typeId="grid-tme"/>
			<channel id="Interval-6-grid-capacity" typeId="battery-target"/>
			<channel id="Interval-6-grid-power-limit" typeId="power-charge-limit"/>
			<channel id="Interval-1-gen-charge" typeId="gen-charge"/>
			<channel id="Interval-2-gen-charge" typeId="gen-charge"/>
			<channel id="Interval-3-gen-charge" typeId="gen-charge"/>
			<channel id="Interval-4-gen-charge" typeId="gen-charge"/>
			<channel id="Interval-5-gen-charge" typeId="gen-charge"/>
			<channel id="Interval-6-gen-charge" typeId="gen-charge"/>
			<channel id="Battery-SOC" typeId="system.battery-level"/>
			<channel id="Battery-grid-voltage" typeId="system.electric-voltage"/>
			<channel id="Battery-grid-current" typeId="system.electric-current"/>
			<channel id="Battery-grid-power" typeId="system.electric-power"/>
			<channel id="Battery-temperature" typeId="system.indoor-temperature"/>
			<channel id="Inverter-ac-temperature" typeId="system.indoor-temperature"/>
			<channel id="Inverter-dc-temperature" typeId="system.indoor-temperature"/>
			<channel id="Inverter-grid-power" typeId="system.electric-power"/>
			<channel id="Inverter-grid-voltage" typeId="system.electric-voltage"/>
			<channel id="Inverter-grid-current" typeId="system.electric-current"/>
			<channel id="Inverter-solar-energy-today" typeId="system.electric-energy"/>
			<channel id="Inverter-solar-energy-total" typeId="system.electric-energy"/>
			<channel id="Inverter-solar-power-now" typeId="system.electric-current"/>
		</channels>
		<config-description>
			<parameter name="sn" type="text" required="true">
				<label>SunSynk Inverter Serial</label>
				<description>Serial number of the inverter</description>
			</parameter>
			<parameter name="alias" type="text" required="true">
				<label>SunSynk Inverter Name</label>
				<description>Name of SunSynk inverter</description>
			</parameter>
			<parameter name="refresh" type="integer" required="true">
				<label>Refresh time</label>
				<description>Time in seconds to retrieve status from SunSynk web services. Greater than 60 seconds</description>
				<default> 60 </default>
				<advanced>true</advanced>
			</parameter>
		</config-description>


	</thing-type>

	<!-- Plant Thing Type -->
	<!--
		<thing-type id="plant">
		<supported-bridge-type-refs>
		<bridge-type-ref id="sunsynkaccount" />
		</supported-bridge-type-refs>
	-->
	<!-- Comment this in for Things which need a Bridge to function.
	-->
	<thing-type id="plant">
		<supported-bridge-type-refs>
			<bridge-type-ref id="sunsynkaccount"/>
		</supported-bridge-type-refs>
		<label>SunSynk Plant</label>
		<description>Plant thing for SunSynk Binding</description>

		<channels>
			<channel id="plant-status" typeId="plant-status"/>
		</channels>

		<config-description>
			<parameter name="hostname" type="text" required="true">
				<context>network-address</context>
				<label>Hostname</label>
				<description>Hostname or IP address of the device</description>
			</parameter>
			<parameter name="password" type="text" required="true">
				<context>password</context>
				<label>Password</label>
				<description>Password to access the device</description>
			</parameter>
			<parameter name="serial" type="text" required="true">
				<context>password</context>
				<label>Gateway Serial Number</label>
				<description>Serial number of the gateway</description>
			</parameter>
			<parameter name="refreshInterval" type="integer" unit="s" min="1">
				<label>Refresh Interval</label>
				<description>Interval the device is polled in sec.</description>
				<default>600</default>
				<advanced>true</advanced>
			</parameter>
		</config-description>
	</thing-type>

	<channel-type id="grid-tme" advanced="true">
		<item-type>DateTime</item-type>
		<label>Grid charge interval start time</label>
		<description>"24hr time for the start of the interval. 00:00 to 23:55 are valid in 5 min increments with leading zero
			on the hour and minute. Times must be in ascending order. ".</description>
		<state readOnly="false" pattern="%1$tH:%1$tM"/>
	</channel-type>

	<channel-type id="grid-charge" advanced="true">
		<item-type>Switch</item-type>
		<label>Grid charge this interval</label>
		<description>charge the inverter battery from the grid.</description>
		<state readOnly="false" pattern="%s"/>
	</channel-type>

	<channel-type id="gen-charge" advanced="true">
		<item-type>Switch</item-type>
		<label>Generator (auxilary) charge this interval</label>
		<description>charge the inverter battery from the generator auxilary.</description>
		<state readOnly="false" pattern="%s"/>
	</channel-type>

	<channel-type id="battery-target" advanced="true">
		<item-type>Number</item-type>
		<label>Target Charge Level</label>
		<category>Battery</category>
		<state min="0" max="100" step="1" pattern="%d" readOnly="false"/>
	</channel-type>

	<channel-type id="power-charge-limit" advanced="true">
		<item-type>Number</item-type>
		<label>Maximum charge rate</label>
		<category>Inverter</category>
		<state min="0" max="100" step="1" pattern="%d %unit%" readOnly="false"/>
	</channel-type>


	<!-- Sample Channel Type -->
	<channel-type id="sample-channel">
		<item-type>Number:Temperature</item-type>
		<label>Example Temperature</label><!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
		<description>Sample channel for SunSynk Binding</description>
	</channel-type>

	<!-- plant-status Channel Type -->
	<channel-type id="plant-status">
		<item-type>String</item-type>
		<label>Current State</label><!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
		<description>State of plant</description>
		<state readOnly="true" pattern="%s">
			<options>
				<option value="OFFLINE">Offline</option>
				<option value="FAULT">Fault</option>
				<option value="WARNING">Warning</option>
				<option value="Normal">Pormal</option>
			</options>
		</state>
	</channel-type>
</thing:thing-descriptions>
